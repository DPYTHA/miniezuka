<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  
  <!-- Titre de l'onglet -->
  <title>√âZUKA - Transferts d'argent rapides</title>

  <!-- Favicon et ic√¥nes CORRIG√âES -->
  <link rel="icon" type="image/png" href="/static/logo.png">
  <link rel="shortcut icon" href="/static/logo.png">
  <link rel="apple-touch-icon" href="/static/logo.png">
  
  <!-- Manifest -->
  <link rel="manifest" href="/static/manifest.json">
  <meta name="theme-color" content="#082630">

  <!-- Open Graph / Facebook - CORRIG√â avec votre domaine -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.ezuka.net/" />
  <meta property="og:title" content="√âZUKA - Transferts d'argent rapides" />
  <meta property="og:description" content="Faites vos transferts d'argent facilement et en toute s√©curit√© avec √âZUKA." />
  <meta property="og:image" content="https://www.ezuka.net/static/logo.png" />
  <meta property="og:image:width" content="512" />
  <meta property="og:image:height" content="512" />

  <!-- Twitter - CORRIG√â -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:url" content="https://www.ezuka.net/" />
  <meta name="twitter:title" content="√âZUKA - Transferts d'argent rapides" />
  <meta name="twitter:description" content="Faites vos transferts d'argent facilement et en toute s√©curit√© avec √âZUKA." />
  <meta name="twitter:image" content="https://www.ezuka.net/static/logo.png" />

  <!-- Police -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&display=swap" rel="stylesheet">
  <meta name="twitter:image" content="https://i.postimg.cc/bw4C62zX/logo.png" />
<title>Envoyer de l'argent</title>
<style>
* {margin:0; padding:0; box-sizing:border-box; font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;}
body {background: linear-gradient(135deg, #667eea 0%,  #0c2137 100%); min-height:100vh; padding:20px;}
.container {max-width:400px; margin:0 auto;}
.header {text-align:center; color:white; margin-bottom:30px;}
.header h1 {font-size:28px; font-weight:600; margin-bottom:10px;}
.balance-card {background: rgba(255,255,255,0.2); border-radius:15px; padding:20px; text-align:center; color:white; margin-bottom:20px; backdrop-filter: blur(10px);}
.balance-label {font-size:14px; opacity:0.9; margin-bottom:5px;}
.balance-amount {font-size:32px; font-weight:700;}
.card {background:white; border-radius:20px; padding:25px; margin-bottom:20px; box-shadow:0 10px 30px rgba(0,0,0,0.2);}
.form-group {margin-bottom:20px;}
.form-group label {display:block; margin-bottom:8px; font-weight:500; color:#333;}
.form-control {width:100%; padding:15px; border:2px solid #e1e1e1; border-radius:12px; font-size:16px; transition:border-color 0.3s;}
.form-control:focus {outline:none; border-color:#667eea;}
.amount-display {background:#f8f9fa; padding:15px; border-radius:12px; text-align:center; margin-top:10px; border:2px solid #e9ecef;}
.amount-label {font-size:14px; color:#666; margin-bottom:5px;}
.amount-value {font-size:20px; font-weight:600; color:#28a745;}
.send-button {background:#0c2137; color:white; border:none; padding:18px; border-radius:12px; font-size:18px; font-weight:600; width:100%; cursor:pointer; transition:background 0.3s; margin-top:20px;}
.send-button:hover {background:#5a6fd8;}
.send-button:disabled {background:#ccc; cursor:not-allowed;}
.modal {display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); backdrop-filter:blur(5px); z-index:1000; align-items:center; justify-content:center;}
.modal-content {background:white; border-radius:20px; padding:30px; max-width:350px; width:90%; text-align:center; box-shadow:0 20px 40px rgba(0,0,0,0.3);}
.modal-icon {font-size:48px; margin-bottom:20px;}
.modal-title {font-size:24px; font-weight:600; margin-bottom:15px; color:#333;}
.modal-message {font-size:16px; color:#666; margin-bottom:25px; line-height:1.5;}
.modal-amount {font-size:28px; font-weight:700; color:#28a745; margin:15px 0;}
.modal-button {background:#667eea; color:white; border:none; padding:15px 30px; border-radius:12px; font-size:16px; font-weight:600; cursor:pointer; transition:background 0.3s;}
.modal-button:hover {background:#5a6fd8;}
.method-option {display:flex; align-items:center; padding:12px; border:2px solid #e1e1e1; border-radius:12px; margin-bottom:10px; cursor:pointer; transition:all 0.3s;}
.method-option:hover {border-color:#667eea;}
.method-option.selected {border-color:#28a745; background-color:#f0fff4;}
.method-icon {width:40px; height:40px; border-radius:8px; display:flex; align-items:center; justify-content:center; margin-right:12px; font-weight:bold; color:white;}
.method-info {flex:1;}
.method-name {font-weight:600; margin-bottom:2px;}
.method-details {font-size:12px; color:#666;}
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>Envoyer de l'argent</h1>
    </div>

    <div class="balance-card">
        <div class="balance-label">Solde disponible</div>
        <div class="balance-amount" id="currentBalance">Chargement...</div>
    </div>

    <div class="card">
        <div class="form-group">
            <label for="recipient_phone">Num√©ro du destinataire</label>
            <input type="tel" id="recipient_phone" class="form-control" placeholder="Ex: +225 07 08 09 10 11" maxlength="15" required>
        </div>

        <div class="form-group">
            <label for="recipient_country">Pays du destinataire</label>
            <select id="recipient_country" class="form-control" required>
                <option value="">S√©lectionnez un pays</option>
                <!-- Les pays seront charg√©s dynamiquement depuis la base de donn√©es -->
            </select>
        </div>

        <div class="form-group">
            <label for="amount">Somme √† envoyer</label>
            <input type="number" id="amount" class="form-control" placeholder="0.00" min="0" step="0.01" required>
        </div>

        <div class="form-group" id="methodGroup" style="display:none;">
            <label>M√©thode de paiement</label>
            <div id="paymentMethods"></div>
        </div>

        <div class="amount-display">
            <div class="amount-label">Taux d'echanges</div>
            <div class="amount-value" id="receivedAmount">0.00 </div>
        </div>

        <button class="send-button" id="sendButton">Envoyer</button>
    </div>
</div>

<div class="modal" id="confirmationModal">
    <div class="modal-content">
        <div class="modal-icon">üí∞</div>
        <div class="modal-title">Transfert r√©ussi !</div>
        <div class="modal-message"> Le destinataire recevra :</div>
        <div class="modal-amount" id="modalAmount">0.00 </div>
        <div class="modal-message" id="modalDetails"></div>
        <button class="modal-button" onclick="closeModal()">OK</button>
    </div>
</div>

<script>
let userCountry = 'C√¥te d\'Ivoire';
let userCurrency = 'XOF';
let selectedMethod = '';
let countryCurrencies = {};
let feesByCurrency = {};
let exchangeRates = {};

// M√©thodes de paiement par pays - VERSION CORRIG√âE avec mapping flexible
const paymentMethods = {
    "C√¥te d'Ivoire": {
        methods: ["Orange Money", "Wave"],
        details: {
            "Orange Money": "Transfert instantan√©",
            "Wave": "Transfert instantan√©"
        }
    },
    "S√©n√©gal": {
        methods: ["Orange Money", "Wave"],
        details: {
            "Orange Money": "Transfert instantan√©",
            "Wave": "Transfert instantan√©"
        }
    },
    "Burkina Faso": {
        methods: ["Orange Money"],
        details: {
            "Orange Money": "Transfert instantan√©"
        }
    },
    "Mali": {
        methods: ["Orange Money"],
        details: {
            "Orange Money": "Transfert instantan√©"
        }
    },
    "Niger": {
        methods: ["Nita"],
        details: {
            "Nita": "Transfert instantan√©"
        }
    },
    "Togo": {
        methods: ["Moov Money"],
        details: {
            "Moov Money": "Transfert instantan√©"
        }
    },
    "B√©nin": {
        methods: ["Moov Money"],
        details: {
            "Moov Money": "Transfert instantan√©"
        }
    },
    "Russie": {
        methods: ["Sberbank", "Tinkoff"],
        details: {
            "Sberbank": "Virement bancaire",
            "Tinkoff": "Virement bancaire"
        }
    },
    "Guin√©e": {
        methods: ["Wave"],
        details: {
            "Wave": "Transfert instantan√©"
        }
    },
    "Cameroun": {
        methods: ["Orange Money"],
        details: {
            "Orange Money": "Transfert instantan√©"
        }
    },
    "Canada": {
        methods: ["Interac"],
        details: {
            "Interac": "Transfert bancaire"
        }
    },
    "Gabon": {
        methods: ["Orange Money"],
        details: {
            "Orange Money": "Transfert instantan√©"
        }
    },
    "Ghana": {
        methods: ["MTN Mobile Money"],
        details: {
            "MTN Mobile Money": "Transfert instantan√©"
        }
    },
    "Nig√©ria": {
        methods: ["Paga"],
        details: {
            "Paga": "Transfert instantan√©"
        }
    }
};

// Mapping des noms de pays pour la compatibilit√©
const countryNameMapping = {
    "Guinee": "Guin√©e",
    "Benin": "B√©nin",
    "C√¥te d'Ivoire": "C√¥te d'Ivoire",
    "S√©n√©gal": "S√©n√©gal", 
    "Burkina Faso": "Burkina Faso",
    "Mali": "Mali",
    "Niger": "Niger",
    "Togo": "Togo",
    "Russie": "Russie",
    "Canada": "Canada",
    "Cameroun": "Cameroun",
    "Gabon": "Gabon",
    "Ghana": "Ghana",
    "Nig√©ria": "Nig√©ria"
};

// Fonction pour charger les configurations depuis l'API
async function loadCurrencyConfig() {
    try {
        console.log("Chargement des configurations de devises...");
        
        // Charger les pays et devises
        const countriesRes = await fetch('/admin/api/country_currencies', {
            credentials: 'include'
        });
        if (countriesRes.ok) {
            const countriesData = await countriesRes.json();
            countriesData.countries.forEach(country => {
                if (country.is_active) {
                    countryCurrencies[country.country_name] = country.currency_code;
                }
            });
            console.log("Pays et devises charg√©s:", countryCurrencies);
        }

        // Charger les frais
        const feesRes = await fetch('/admin/api/currency_configs', {
            credentials: 'include'
        });
        if (feesRes.ok) {
            const feesData = await feesRes.json();
            feesData.configs.forEach(config => {
                if (config.is_active) {
                    feesByCurrency[config.currency_code] = config.transfer_fee_percent;
                }
            });
            console.log("Frais charg√©s:", feesByCurrency);
        }

        // Charger les taux de change
        const ratesRes = await fetch('/admin/api/exchange_rates', {
            credentials: 'include'
        });
        if (ratesRes.ok) {
            const ratesData = await ratesRes.json();
            ratesData.rates.forEach(rate => {
                if (rate.is_active) {
                    const key = `${rate.from_currency},${rate.to_currency}`;
                    exchangeRates[key] = rate.rate;
                }
            });
            console.log("Taux de change charg√©s:", exchangeRates);
        }

        // Mettre √† jour les s√©lecteurs de pays
        updateCountrySelectors();
        
    } catch (err) {
        console.error("Erreur lors du chargement des configurations:", err);
        // Fallback vers les valeurs par d√©faut en cas d'erreur
        loadDefaultConfig();
    }
}

// Configuration par d√©faut (fallback)
function loadDefaultConfig() {
    countryCurrencies = {
        "C√¥te d'Ivoire": "XOF",
        "Mali": "XOF",
        "Burkina Faso": "XOF",
        "S√©n√©gal": "XOF",
        "Guin√©e": "GNF",
        "Russie": "RUB",
        "Canada": "CAD",
        "Cameroun": "XAF",
        "Niger": "XOF",
        "Togo": "XOF",
        "B√©nin": "XOF",
        "Gabon": "XAF",
        "Ghana": "GHS",
        "Nig√©ria": "NGN"
    };

    feesByCurrency = {
        "XOF": 2.5,
        "GNF": 2.5,
        "RUB": 3.0,
        "CAD": 3.5,
        "XAF": 2.5,
        "GHS": 3.0,
        "NGN": 3.0
    };

    exchangeRates = {
        "XOF,XAF": 0.85,
        "XOF,GNF": 13.0,
        "XOF,RUB": 0.132,
        "XOF,CAD": 0.0022,
        "XOF,XOF": 1.0,
        "XAF,XOF": 1.1,
        "XAF,GNF": 12.0,
        "XAF,RUB": 0.129,
        "XAF,CAD": 0.0020,
        "XAF,XAF": 1.0,
        "GNF,XOF": 0.077,
        "GNF,RUB": 0.011,
        "GNF,CAD": 0.00017,
        "GNF,GNF": 1.0,
        "RUB,XOF": 6.6,
        "RUB,GNF": 90.0,
        "RUB,CAD": 0.015,
        "RUB,RUB": 1.0,
        "CAD,XOF": 450.0,
        "CAD,GNF": 6000.0,
        "CAD,RUB": 67.0,
        "CAD,CAD": 1.0,
    };
}

// Mettre √† jour les s√©lecteurs de pays avec les donn√©es de la base
function updateCountrySelectors() {
    const countrySelect = document.getElementById('recipient_country');
    
    // Sauvegarder la valeur s√©lectionn√©e
    const currentValue = countrySelect.value;
    
    // Vider les options existantes (garder la premi√®re option)
    while (countrySelect.options.length > 1) {
        countrySelect.remove(1);
    }
    
    // Ajouter les pays depuis la base de donn√©es
    Object.keys(countryCurrencies).sort().forEach(countryName => {
        const option = document.createElement('option');
        option.value = countryName;
        option.textContent = countryName;
        countrySelect.appendChild(option);
    });
    
    // Restaurer la s√©lection si elle existe toujours
    if (currentValue && countryCurrencies[currentValue]) {
        countrySelect.value = currentValue;
    }
}

// Fonction pour trouver le nom de pays compatible
function getCompatibleCountryName(countryName) {
    // Essayer d'abord le nom exact
    if (paymentMethods[countryName]) {
        return countryName;
    }
    
    // Chercher dans le mapping
    for (const [key, value] of Object.entries(countryNameMapping)) {
        if (value === countryName) {
            return key;
        }
    }
    
    // Essayer une correspondance partielle
    for (const key of Object.keys(paymentMethods)) {
        if (key.includes(countryName) || countryName.includes(key)) {
            return key;
        }
    }
    
    return null;
}

// Fonction pour afficher les m√©thodes de paiement - VERSION CORRIG√âE
function showPaymentMethods(country) {
    const methodGroup = document.getElementById('methodGroup');
    const paymentMethodsContainer = document.getElementById('paymentMethods');
    
    // R√©initialiser la s√©lection
    selectedMethod = '';
    
    if (!country) {
        methodGroup.style.display = 'none';
        return;
    }
    
    // Trouver le nom de pays compatible
    const compatibleCountry = getCompatibleCountryName(country);
    console.log(`Pays s√©lectionn√©: ${country}, Compatible: ${compatibleCountry}`);
    
    if (compatibleCountry && paymentMethods[compatibleCountry]) {
        const methods = paymentMethods[compatibleCountry].methods;
        const details = paymentMethods[compatibleCountry].details;
        
        console.log(`M√©thodes trouv√©es pour ${compatibleCountry}:`, methods);
        
        if (methods.length === 1) {
            // Une seule m√©thode - s√©lection automatique
            selectedMethod = methods[0];
            methodGroup.style.display = 'none';
            console.log(`M√©thode automatique s√©lectionn√©e: ${selectedMethod}`);
        } else {
            // Plusieurs m√©thodes - afficher le choix
            methodGroup.style.display = 'block';
            paymentMethodsContainer.innerHTML = '';
            
            methods.forEach(method => {
                const methodDiv = document.createElement('div');
                methodDiv.className = 'method-option';
                methodDiv.onclick = () => selectMethod(method, methodDiv);
                
                // Couleurs diff√©rentes pour chaque m√©thode
                const colors = {
                    "Orange Money": "#FF6600",
                    "Wave": "#00A859",
                    "Moov Money": "#FF0000",
                    "Nita": "#0066CC",
                    "Sberbank": "#1A9F29",
                    "Tinkoff": "#FFDD00",
                    "Interac": "#0056B3",
                    "MTN Mobile Money": "#FFCC00",
                    "Paga": "#800080"
                };
                
                methodDiv.innerHTML = `
                    <div class="method-icon" style="background-color: ${colors[method] || '#667eea'}">
                        ${method.charAt(0)}
                    </div>
                    <div class="method-info">
                        <div class="method-name">${method}</div>
                        <div class="method-details">${details[method] || 'Transfert'}</div>
                    </div>
                `;
                
                paymentMethodsContainer.appendChild(methodDiv);
            });
            
            console.log(`${methods.length} m√©thodes affich√©es pour ${country}`);
        }
    } else {
        methodGroup.style.display = 'none';
        console.log(`Aucune m√©thode trouv√©e pour: ${country}`);
    }
    
    updateSendButton();
}

// Fonction pour s√©lectionner une m√©thode
function selectMethod(method, element) {
    // D√©s√©lectionner toutes les m√©thodes
    document.querySelectorAll('.method-option').forEach(opt => {
        opt.classList.remove('selected');
    });
    
    // S√©lectionner la m√©thode cliqu√©e
    element.classList.add('selected');
    selectedMethod = method;
    console.log(`M√©thode s√©lectionn√©e: ${selectedMethod}`);
    updateSendButton();
}

function calculateReceivedAmount() {
    const amount = parseFloat(document.getElementById('amount').value) || 0;
    const recipientCountry = document.getElementById('recipient_country').value;
    
    if (!amount || !recipientCountry) {
        document.getElementById('receivedAmount').textContent = '0.00 ';
        return;
    }

    // D√©terminer les devises
    const senderCurrency = userCurrency;
    const recipientCurrency = countryCurrencies[recipientCountry] || "XOF";

    if (!senderCurrency || !recipientCurrency) {
        document.getElementById('receivedAmount').textContent = 'Configuration manquante';
        return;
    }

    // Calcul des frais et conversion
    const feePercent = feesByCurrency[senderCurrency] || 3.5;
    const feeAmount = amount * feePercent / 100;
    
    // Chercher le taux de change direct ou inverse
    let conversionRate = exchangeRates[`${senderCurrency},${recipientCurrency}`];
    if (!conversionRate && senderCurrency !== recipientCurrency) {
        // Essayer le taux inverse
        const inverseRate = exchangeRates[`${recipientCurrency},${senderCurrency}`];
        if (inverseRate) {
            conversionRate = 1 / inverseRate;
        } else {
            conversionRate = 1.0; // Fallback
        }
    }
    
    const receivedAmount = (amount - feeAmount) * (conversionRate || 1.0);

    // Mise √† jour de l'affichage
    const displayText = receivedAmount.toFixed(2) + ' ' + recipientCurrency;
    document.getElementById('receivedAmount').textContent = displayText;
    
    updateSendButton();
}

function updateSendButton() {
    const phone = document.getElementById('recipient_phone').value;
    const country = document.getElementById('recipient_country').value;
    const amount = parseFloat(document.getElementById('amount').value) || 0;
    const btn = document.getElementById('sendButton');
    
    // V√©rifier si une m√©thode est n√©cessaire et s√©lectionn√©e
    let methodValid = true;
    const compatibleCountry = getCompatibleCountryName(country);
    
    if (compatibleCountry && paymentMethods[compatibleCountry] && paymentMethods[compatibleCountry].methods.length > 1) {
        methodValid = selectedMethod !== '';
        console.log(`Validation m√©thode: ${methodValid}, M√©thode s√©lectionn√©e: ${selectedMethod}`);
    }
    
    btn.disabled = !phone || !country || amount <= 0 || !methodValid;
}

async function sendMoney() {
    const phone = document.getElementById('recipient_phone').value;
    const country = document.getElementById('recipient_country').value;
    const amount = parseFloat(document.getElementById('amount').value);

    if (!phone || !country || amount <= 0) {
        alert('Veuillez remplir tous les champs correctement');
        return;
    }

    // V√©rifier la m√©thode de paiement si n√©cessaire
    let paymentMethod = '';
    const compatibleCountry = getCompatibleCountryName(country);
    
    if (compatibleCountry && paymentMethods[compatibleCountry]) {
        if (paymentMethods[compatibleCountry].methods.length > 1) {
            if (!selectedMethod) {
                alert('Veuillez s√©lectionner une m√©thode de paiement');
                return;
            }
            paymentMethod = selectedMethod;
        } else {
            // Une seule m√©thode disponible
            paymentMethod = paymentMethods[compatibleCountry].methods[0];
        }
    }

    const btn = document.getElementById('sendButton');
    btn.disabled = true;
    btn.textContent = 'Envoi en cours...';

    try {
        const res = await fetch('/api/transfer', {
            method: 'POST',
            headers: {'Content-Type':'application/json'},
            credentials: 'include',
            body: JSON.stringify({
                recipient_phone: phone, 
                amount: amount,
                recipient_country: country,
                payment_method: paymentMethod,
                note: `Vers ${country} - ${paymentMethod}`
            })
        });
        
        const data = await res.json();
        
        if (data.ok) {
            // Utiliser les valeurs calcul√©es par le backend pour l'affichage modal
            document.getElementById('modalAmount').textContent = 
                data.net_received.toFixed(2) + ' ' + data.recipient_currency;
            
            // Afficher les informations avec la m√©thode de paiement
            document.getElementById('modalDetails').innerHTML = 
                `Montant envoy√©: ${data.amount_sent.toFixed(2)} ${data.sender_currency}<br>
                 M√©thode: ${data.payment_method || paymentMethod}<br>
                 Solde restant: ${data.sender_balance.toFixed(2)} ${data.sender_currency}`;
            
            document.getElementById('confirmationModal').style.display = 'flex';
            await loadBalance(); // Recharger le solde apr√®s le transfert
        } else {
            alert('Erreur: ' + (data.error || 'Erreur serveur'));
        }
    } catch(err) {
        console.error(err);
        alert('Erreur lors de l\'envoi');
    } finally {
        btn.disabled = false;
        btn.textContent = 'Envoyer';
    }
}

function closeModal() {
    document.getElementById('confirmationModal').style.display = 'none';
    // R√©initialiser le formulaire
    document.getElementById('recipient_phone').value = '';
    document.getElementById('recipient_country').value = '';
    document.getElementById('amount').value = '';
    document.getElementById('receivedAmount').textContent = '0.00 ';
    document.getElementById('methodGroup').style.display = 'none';
    selectedMethod = '';
}

async function loadBalance() {
    try {
        console.log("Chargement du solde...");
        const res = await fetch('/api/user_info', {
            method: 'GET',
            credentials: 'include'
        });

        if (!res.ok) {
            throw new Error(`Erreur HTTP: ${res.status}`);
        }

        const data = await res.json();
        console.log("Donn√©es re√ßues:", data);
        
        if (data.ok && data.user) {
            const balance = data.user.balance.toFixed(2);
            const currency = data.user.currency;
            
            document.getElementById('currentBalance').textContent = balance + ' ' + currency;
            
            userCountry = data.user.country;
            userCurrency = data.user.currency;
            
            console.log("Solde charg√©:", balance, currency);
            console.log("Pays utilisateur:", userCountry);
            console.log("Devise utilisateur:", userCurrency);
            
            // Recalculer le montant re√ßu avec les nouvelles informations utilisateur
            calculateReceivedAmount();
        } else {
            throw new Error(data.error || 'Erreur dans les donn√©es utilisateur');
        }
        
    } catch (err) {
        console.error("Erreur lors du chargement du solde:", err);
        document.getElementById('currentBalance').textContent = 'Erreur';
        
        // Rediriger vers la page de login si non authentifi√©
        if (err.message.includes('401') || err.message.includes('non connect√©')) {
            setTimeout(() => {
                window.location.href = '/login';
            }, 2000);
        }
    }
}

// Fonction pour rafra√Æchir les configurations (utile si l'admin les modifie)
async function refreshConfig() {
    console.log("Rafra√Æchissement des configurations...");
    await loadCurrencyConfig();
    calculateReceivedAmount(); // Recalculer avec les nouvelles donn√©es
}

// Chargement initial au d√©marrage
document.addEventListener('DOMContentLoaded', async function() {
    console.log("DOM charg√©, initialisation...");
    
    // Charger d'abord les configurations
    await loadCurrencyConfig();
    
    // Ensuite charger le solde utilisateur
    await loadBalance();
    
    // √âv√©nements
    document.getElementById('amount').addEventListener('input', calculateReceivedAmount);
    document.getElementById('recipient_country').addEventListener('change', function() {
        calculateReceivedAmount();
        showPaymentMethods(this.value);
    });
    document.getElementById('recipient_phone').addEventListener('input', updateSendButton);
    document.getElementById('sendButton').addEventListener('click', sendMoney);
    
    console.log("Initialisation termin√©e");
});
</script>
</body>
</html>